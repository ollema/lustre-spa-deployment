var f=class{withFields(e){let r=Object.keys(this).map(s=>s in e?e[s]:this[s]);return new this.constructor(...r)}},A=class{static fromArray(e,r){let s=r||new H;for(let o=e.length-1;o>=0;--o)s=new G(e[o],s);return s}[Symbol.iterator](){return new ae(this)}toArray(){return[...this]}atLeastLength(e){for(let r of this){if(e<=0)return!0;e--}return e<=0}hasLength(e){for(let r of this){if(e<=0)return!1;e--}return e===0}countLength(){let e=0;for(let r of this)e++;return e}};function l(t,e){return A.fromArray(t,e)}var ae=class{#e;constructor(e){this.#e=e}next(){if(this.#e instanceof H)return{done:!0};{let{head:e,tail:r}=this.#e;return this.#e=r,{value:e,done:!1}}}},H=class extends A{},G=class extends A{constructor(e,r){super(),this.head=e,this.tail=r}};var F=class t extends f{static isResult(e){return e instanceof t}},d=class extends F{constructor(e){super(),this[0]=e}isOk(){return!0}},a=class extends F{constructor(e){super(),this[0]=e}isOk(){return!1}};function pe(t,e,r,s,o,u){let n=new globalThis.Error(o);n.gleam_error=t,n.module=e,n.line=r,n.fn=s;for(let i in u)n[i]=u[i];return n}var O=class extends f{};var er=new DataView(new ArrayBuffer(8));var Ve=5,de=Math.pow(2,Ve),tr=de-1,rr=de/2,nr=de/4;var ve=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(),xr=new RegExp(`^([${ve}]*)`,"g"),$r=new RegExp(`([${ve}]*)$`,"g");function $e(t,e,r){return t?e:r()}var ge=class extends f{constructor(e){super(),this.all=e}};function ye(){return new ge(l([]))}var D=class extends f{constructor(e){super(),this.content=e}},_=class extends f{constructor(e,r,s,o,u,n,i){super(),this.key=e,this.namespace=r,this.tag=s,this.attrs=o,this.children=u,this.self_closing=n,this.void=i}};function U(t,e,r){return t==="area"?new _("","",t,e,l([]),!1,!0):t==="base"?new _("","",t,e,l([]),!1,!0):t==="br"?new _("","",t,e,l([]),!1,!0):t==="col"?new _("","",t,e,l([]),!1,!0):t==="embed"?new _("","",t,e,l([]),!1,!0):t==="hr"?new _("","",t,e,l([]),!1,!0):t==="img"?new _("","",t,e,l([]),!1,!0):t==="input"?new _("","",t,e,l([]),!1,!0):t==="link"?new _("","",t,e,l([]),!1,!0):t==="meta"?new _("","",t,e,l([]),!1,!0):t==="param"?new _("","",t,e,l([]),!1,!0):t==="source"?new _("","",t,e,l([]),!1,!0):t==="track"?new _("","",t,e,l([]),!1,!0):t==="wbr"?new _("","",t,e,l([]),!1,!0):new _("","",t,e,r,!1,!1)}function te(t){return new D(t)}var re=class extends f{constructor(e){super(),this[0]=e}},y=class extends f{constructor(e){super(),this[0]=e}};var v=class extends f{};var ne=class extends f{constructor(e){super(),this[0]=e}};function be(t,e,r,s=!1){let o,u=[{prev:t,next:e,parent:t.parentNode}];for(;u.length;){let{prev:n,next:i,parent:c}=u.pop();if(i.subtree!==void 0&&(i=i.subtree()),i.content!==void 0)if(n)if(n.nodeType===Node.TEXT_NODE)n.textContent!==i.content&&(n.textContent=i.content),o??=n;else{let p=document.createTextNode(i.content);c.replaceChild(p,n),o??=p}else{let p=document.createTextNode(i.content);c.appendChild(p),o??=p}else if(i.tag!==void 0){let p=Nt({prev:n,next:i,dispatch:r,stack:u,isComponent:s});n?n!==p&&c.replaceChild(p,n):c.appendChild(p),o??=p}else i.elements!==void 0?W(i,p=>{u.unshift({prev:n,next:p,parent:c}),n=n?.nextSibling}):i.subtree!==void 0&&u.push({prev:n,next:i,parent:c})}return o}function Nt({prev:t,next:e,dispatch:r,stack:s}){let o=e.namespace||"http://www.w3.org/1999/xhtml",u=t&&t.nodeType===Node.ELEMENT_NODE&&t.localName===e.tag&&t.namespaceURI===(e.namespace||"http://www.w3.org/1999/xhtml"),n=u?t:o?document.createElementNS(o,e.tag):document.createElement(e.tag),i;if(P.has(n))i=P.get(n);else{let h=new Map;P.set(n,h),i=h}let c=u?new Set(i.keys()):null,p=u?new Set(Array.from(t.attributes,h=>h.name)):null,b=null,I=null,ue=null;for(let h of e.attrs){let m=h[0],$=h[1];if(h.as_property)n[m]!==$&&(n[m]=$),u&&p.delete(m);else if(m.startsWith("on")){let L=m.slice(2),ce=r($);i.has(L)||n.addEventListener(L,R),i.set(L,ce),u&&c.delete(L)}else if(m.startsWith("data-lustre-on-")){let L=m.slice(15),ce=r(zt);i.has(L)||n.addEventListener(L,R),i.set(L,ce),n.setAttribute(m,$)}else m==="class"?b=b===null?$:b+" "+$:m==="style"?I=I===null?$:I+$:m==="dangerous-unescaped-html"?ue=$:(n.getAttribute(m)!==$&&n.setAttribute(m,$),(m==="value"||m==="selected")&&(n[m]=$),u&&p.delete(m))}if(b!==null&&(n.setAttribute("class",b),u&&p.delete("class")),I!==null&&(n.setAttribute("style",I),u&&p.delete("style")),u){for(let h of p)n.removeAttribute(h);for(let h of c)i.delete(h),n.removeEventListener(h,R)}if(e.key!==void 0&&e.key!=="")n.setAttribute("data-lustre-key",e.key);else if(ue!==null)return n.innerHTML=ue,n;let k=n.firstChild,le=null,Oe=null,Le=null,fe=e.children[Symbol.iterator]().next().value;u&&fe!==void 0&&fe.key!==void 0&&fe.key!==""&&(le=new Set,Oe=De(t),Le=De(e));for(let h of e.children)W(h,m=>{m.key!==void 0&&le!==null?k=It(k,m,n,s,Le,Oe,le):(s.unshift({prev:k,next:m,parent:n}),k=k?.nextSibling)});for(;k;){let h=k.nextSibling;n.removeChild(k),k=h}return n}var P=new WeakMap;function R(t){let e=t.currentTarget;if(!P.has(e)){e.removeEventListener(t.type,R);return}let r=P.get(e);if(!r.has(t.type)){e.removeEventListener(t.type,R);return}r.get(t.type)(t)}function zt(t){let e=t.currentTarget,r=e.getAttribute(`data-lustre-on-${t.type}`),s=JSON.parse(e.getAttribute("data-lustre-data")||"{}"),o=JSON.parse(e.getAttribute("data-lustre-include")||"[]");switch(t.type){case"input":case"change":o.push("target.value");break}return{tag:r,data:o.reduce((u,n)=>{let i=n.split(".");for(let c=0,p=u,b=t;c<i.length;c++)c===i.length-1?p[i[c]]=b[i[c]]:(p[i[c]]??={},b=b[i[c]],p=p[i[c]]);return u},{data:s})}}function De(t){let e=new Map;if(t)for(let r of t.children)W(r,s=>{let o=s?.key||s?.getAttribute?.("data-lustre-key");o&&e.set(o,s)});return e}function It(t,e,r,s,o,u,n){for(;t&&!o.has(t.getAttribute("data-lustre-key"));){let c=t.nextSibling;r.removeChild(t),t=c}if(u.size===0)return W(e,c=>{s.unshift({prev:t,next:c,parent:r}),t=t?.nextSibling}),t;if(n.has(e.key))return console.warn(`Duplicate key found in Lustre vnode: ${e.key}`),s.unshift({prev:null,next:e,parent:r}),t;n.add(e.key);let i=u.get(e.key);if(!i&&!t)return s.unshift({prev:null,next:e,parent:r}),t;if(!i&&t!==null){let c=document.createTextNode("");return r.insertBefore(c,t),s.unshift({prev:c,next:e,parent:r}),t}return!i||i===t?(s.unshift({prev:t,next:e,parent:r}),t=t?.nextSibling,t):(r.insertBefore(i,t),s.unshift({prev:i,next:e,parent:r}),t)}function W(t,e){if(t.elements!==void 0)for(let r of t.elements)e(r);else t.subtree!==void 0?W(t.subtree(),e):e(t)}var ie=class t{#e=null;#r=[];#t=[];#n=!1;#o=!1;#i=null;#u=null;#s=null;static start(e,r,s,o,u){if(!se())return new a(new z);let n=r instanceof HTMLElement?r:document.querySelector(r);if(!n)return new a(new oe(r));let i=new t(s(e),o,u,n);return new d(c=>i.send(c))}constructor([e,r],s,o,u=document.body,n=!1){this.#i=e,this.#u=s,this.#s=o,this.#e=u,this.#t=r.all.toArray(),this.#n=!0,this.#o=n,window.requestAnimationFrame(()=>this.#l())}send(e){switch(!0){case e instanceof y:{this.#r.push(e[0]),this.#l();return}case e instanceof v:{this.#a();return}case e instanceof re:{this.#c(e[0]);return}default:return}}emit(e,r){this.#e.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:r,composed:!0}))}#l(){if(this.#f(),this.#n){let e=this.#s(this.#i),r=s=>o=>{let u=s(o);u instanceof d&&this.send(new y(u[0]))};this.#n=!1,this.#e=be(this.#e,e,r,this.#o)}}#f(e=0){for(;this.#r.length;){let[r,s]=this.#u(this.#i,this.#r.shift());this.#n||=this.#i!==r,this.#i=r,this.#t=this.#t.concat(s.all.toArray())}for(;this.#t.length;)this.#t.shift()(r=>this.send(new y(r)),(r,s)=>this.emit(r,s));this.#r.length&&(e<5?this.#f(++e):window.requestAnimationFrame(()=>this.#l()))}#c(e){switch(!0){case e instanceof ne:{let r=this.#s(e[0]),s=o=>u=>{let n=o(u);n instanceof d&&this.send(new y(n[0]))};this.#r=[],this.#t=[],this.#n=!1,this.#e=be(this.#e,r,s,this.#o)}}}#a(){this.#e.remove(),this.#e=null,this.#i=null,this.#r=[],this.#t=[],this.#n=!1,this.#u=()=>{},this.#s=()=>{}}},Ue=(t,e,r)=>ie.start(r,e,t.init,t.update,t.view),se=()=>globalThis.window&&window.document;var ke=class extends f{constructor(e,r,s,o){super(),this.init=e,this.update=r,this.view=s,this.on_attribute_change=o}};var oe=class extends f{constructor(e){super(),this.selector=e}},z=class extends f{};function Ft(t,e,r){return new ke(t,e,r,new O)}function Pe(t){return Ft(o=>[void 0,ye()],(o,u)=>[void 0,ye()],o=>t)}function Re(t,e,r){return $e(!se(),new a(new z),()=>Ue(t,e,r))}function We(t,e){return U("h1",t,e)}function He(t,e){return U("div",t,e)}function Ge(t,e){return U("p",t,e)}function Je(){let t=Pe(He(l([]),l([We(l([]),l([te("Hello, world!")])),Ge(l([]),l([te("from a Lustre SPA deployment demo")]))]))),e=Re(t,"#app",void 0);if(!e.isOk())throw pe("assignment_no_match","app",13,"main","Assignment pattern did not match",{value:e})}Je();
